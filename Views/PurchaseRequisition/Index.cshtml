@model Document_Control.Core.pageModels.PurchaseRequisition.PagePR
@{
	ViewData["Title"] = "PurchaseRequisition";
	Layout = "~/Views/Shared/_Layout.cshtml";
}


<style>
	.dashboard .activity .activity-item .activite-label {
		min-width: 0px;
	}
</style>

<main id="main" class="main">

	@Html.HiddenFor(x => x.Id)
	@Html.HiddenFor(x => x.OrderDate)
	@Html.HiddenFor(x => x.DocumentCode)
	@Html.HiddenFor(x => x.CreateBy)
	@Html.HiddenFor(x => x.CreateName)
	@Html.HiddenFor(x => x.PositionId)
	@Html.HiddenFor(x => x.PositionName)
	<section class="section dashboard">
		<div class="row">
			<div class="col-lg-8">
				<div class="row">
					<div class="col-12">
						<div class="card">
							<div class="card-body">
								<h5 class="card-title">ข้อมูล <span>| Request Information</span></h5>
								<div class="row">
									<div class="col-6 mb-1">
										<div class="row">
											<div class="col-2">
												<i class="ri-calendar-todo-fill icon-size"></i>
											</div>
											<div class="col-10">
												<div class="row">
													<div class="col col-12 ga-text-grey ga-text-font-size-1rem "><b>วันที่สร้าง :</b> </div>
													<div class="col col-12 ga-text-lh-10">@Model?.OrderDate?.ToString("dd/MM/yyyy")</div>
												</div>

											</div>
										</div>
									</div>

									<div class="col-6 mb-1">
										<div class="row">
											<div class="col-2">
												<i class="ri-article-fill icon-size"></i>
											</div>
											<div class="col-10">
												<div class="row">
													<div class="col col-12 ga-text-grey ga-text-font-size-1rem "><b>เลขที่เอกสาร :</b> </div>
													<div class="col col-12 ga-text-lh-10">@Model?.DocumentCode</div>
												</div>
											</div>
										</div>
									</div>
									<div class="col-6 mb-1">
										<div class="row">
											<div class="col-2">
												<i class="ri-file-user-fill icon-size"></i>
											</div>
											<div class="col-10">
												<div class="row">
													<div class="col col-12 ga-text-grey ga-text-font-size-1rem "><b>ชื่อ-นามสกุล :</b> </div>
													<div class="col col-12 ga-text-lh-10">@Model?.CreateName</div>
												</div>
											</div>
										</div>
									</div>
									<div class="col-6 mb-1">
										<div class="row">
											<div class="col-2">
												<i class="ri-git-repository-fill icon-size"></i>
											</div>
											<div class="col-10">
												<div class="row">
													<div class="col col-12 ga-text-grey ga-text-font-size-1rem "><b>ตำแหน่ง :</b> </div>
													<div class="col col-12 ga-text-lh-10">@Model?.PositionName</div>
												</div>
											</div>
										</div>
									</div>
								</div>


								@* 							<div class="col-md-6">
								<label for="inputName5" class="form-label">Your Name</label>
								<input type="text" class="form-control" >
								</div>
								*@
							</div>
						</div>

					</div>
					<div class="col-12">
						<div class="card">
							<div class="card-body">
								<h5 class="card-title">รายละเอียด <span>/Detail</span></h5>
								<div class="row g-3">
									<div class="col-12">
										<label class="form-label"><b class="text-danger me-1">*</b><b>ความสำคัญ</b></label>
										@Html.DropDownListFor(x => x.PriorityId, Model?.lPriority, "เลือก", new { @class = "form-control" })
									</div>
									<div class="col-12">
										<label class="form-label"><b class="text-danger me-1">*</b><b>หัวเรื่อง</b></label>
										@Html.TextBoxFor(x => x.Subject, new { @class = "form-control" })
									</div>
									<div class="col-12">
										<label class="form-label"><b class="text-danger me-1">*</b><b>งบประมาน</b></label>
										@Html.TextBoxFor(x => x.Budget, new { @class = "form-control", @id = "budgetInput", onchange = "controller.handleBudgetChange()" })
									</div>

									<div class="col-6">
										<label class="form-label"><b class="text-danger me-1">*</b><b>บริษัท</b></label>
										@Html.DropDownListFor(x => x.CompanyId, Model?.lCompany, "เลือก", new { @class = "form-control" })
									</div>
									<div class="col-6">
										<label class="form-label"><b class="text-danger me-1">*</b><b>แผนก</b></label>
										@Html.DropDownListFor(x => x.DivisionId, Model?.lDivision, "เลือก", new { @class = "form-control" })
									</div>
									<div class="col-6">
										<label class="form-label"><b>พนักงาน</b></label>
										@Html.DropDownListFor(x => x.UserId, Model?.lUser, "เลือก", new { @class = "form-control" })
									</div>
									<div class="col-6">
										<label class="form-label"><b class="text-danger me-1">*</b><b>ซัพพลายเออร์</b></label>
										@Html.TextBoxFor(x => x.SupplierName, new { @class = "form-control" })
									</div>
									<div class="col-12">
										<label class="form-label"><b class="text-danger me-1">*</b><b>รายละเอียดเพิ่มเติม</b></label>
										@Html.TextAreaFor(x => x.Description, new { @class = "form-control", rows = 3 })
									</div>
								</div>


							</div>

						</div>
					</div>
					<div class="col-12">
						<div class="card recent-sales overflow-auto">
							<div class="card-body">
								<h5 class="card-title">ไฟล์แนบ <span>| Attach Files</span></h5>
								<table class="table table-bordered">
									<tr>
										<th scope="col">ชื่อไฟล์</th>
									</tr>
									<tbody>
										<tr>
											<td><span class="badge bg-danger me-1" onclick="$('#positionApprove').modal('show');">ลบ</span>รายละเอียดขอจัดซื้อเรือดำน้ำ 15 ลำ</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>



					<div class="col-12" id="componentApproval">
					</div>







					<div class="col-12">
						<div class="card recent-sales overflow-auto">
							<div class="card-body">
								<h5 class="card-title">หมายเหตุ <span>| Reason</span></h5>
								<div class="row g-3">
									<div class="col-12">
										@Html.TextAreaFor(x => x.Reason, new { @class = "form-control", rows = 3 })
									</div>
									<div class="col-12">
										<button type="button" onclick="controller.save();" class="btn btn-primary"><i class="ri-draft-fill me-1"></i>บันทึกร่าง</button>
										<button type="button" onclick="controller.save();" class="btn btn-success"><i class="ri-save-3-fill me-1"></i>บันทึก</button>
										<button type="button" onclick="controller.reject();" class="btn btn-danger"><i class="ri-arrow-go-back-fill me-1"></i>ส่งกลับ</button>
									</div>
								</div>

							</div>
						</div>
					</div>


					<div class="col-12 mt-4">
						<div class="card top-selling overflow-auto">


							<div class="card-body pb-0">
								<h5 class="card-title">ประวัติ <span>| History</span></h5>

								<table class="table table-borderless">
									<thead>
										<tr>

											<th scope="col">วันที่</th>
											<th scope="col">ชื่อ-นามสกุล</th>
											<th scope="col">ตำแหน่ง</th>
											<th scope="col">หมายเหตุ</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td>1/7/2024 12:14:00</td>
											<td>ชาติ เลิศคุณวงส์</td>
											<td>เจ้าหน้าที่</td>
											<td>ขออนุมัติเรือดำน้ำ</td>
										</tr>
										<tr>
											<td>2/7/2024 15:30:00</td>
											<td>ประยุทธ์ จันทร์นะจ๊ะ</td>
											<td>นายกรัฐมนตรี</td>
											<td>ok อนุมัติ</td>
										</tr>
									</tbody>
								</table>

							</div>

						</div>
					</div><!-- End Top Selling -->

				</div>
			</div><!-- End Left side columns -->
			<!-- Right side columns -->
			<div class="col-lg-4">

				<!-- Recent Activity -->
				<div class="card">
					<div class="card-body">
						<h5 class="card-title">สถานะ <span>| Status</span></h5>

						<div class="activity">
							<div class="activity-item d-flex">
								<div class="activite-label"></div>
								<i class="bi bi-circle-fill activity-badge text-success align-self-start"></i>
								<div class="activity-content">
									<b>สร้างเอกสาร</b><br />ชาติ เลิศคุณวงส์
								</div>
							</div>

							<div class="activity-item d-flex">
								<div class="activite-label"></div>
								<i class="bi bi-circle-fill activity-badge text-success align-self-start"></i>
								<div class="activity-content">
									<b>รออนุมัติ</b><br />ประยุทธ์ จันทร์นะจ๊ะ
								</div>
							</div>
							<div class="activity-item d-flex">
								<div class="activite-label"></div>
								<i class="bi bi-circle-fill activity-badge text-success align-self-start"></i>
								<div class="activity-content">
									<b>ดำเนินการเสร็จสิ้น</b>
								</div>
							</div>

						</div>

					</div>
				</div>
			</div>

		</div>

		<!-- #region name -->

		<div class="modal fade" id="positionApprove" tabindex="-1" aria-modal="true" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">ผู้อนุมัติ</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<table class="table table-bordered">
							<tbody>
								<tr>
									<th scope="col">ชื่อ-นามสกุล</th>
									<th scope="col">ติดต่อ</th>
								</tr>
							</tbody>
							<tbody>
								<tr>
									<td>ชาติ เลิศคุณวงส์</td>
									<td>099-2978004</td>
								</tr>
								<tr>
									<td>ประยุทธ์ จันทร์นะจ๊ะ</td>
									<td>099-2978006</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
					</div>
				</div>
			</div>
		</div>

		<!-- #endregion -->

	</section>

</main>
@section Scripts {
	<script>
		$(document).ready(function () {

			loadComponent();



			controller.handleBudgetChange = function () {
				const budgetInput = document.getElementById('budgetInput');
				let value = parseFloat(budgetInput.value).toFixed(2);
				if (!isNaN(value)) {
					budgetInput.value = value;
				} else {
					budgetInput.value = '';
				}
				loadComponent();
			}
			controller.save = function () {
				services.ConfirmAlert("", "", "", "", "", function (result) {
					if (result.isConfirmed) {
						services.AjaxPostData("@Url.Action("Save", "PurchaseRequisition")", { key1: key }, function (response) {
							services.CustomAlert1(response);
						});
					}
				});
			}
			controller.reject = function () {
			}
		});
		function loadComponent() {
			var budgetValue = document.getElementById('budgetInput').value;
			$.ajax({
				url: '@Url.Action("LoadComponentApproval", "PurchaseRequisition")',
				type: 'GET',
				data: { id: @Model?.Id, budget: budgetValue },
				success: function (data) {
					$('#componentApproval').html(data);
				}
			});
		}
	</script>
}